name: main branch - test; build & push to ghcr

on:
  push:
    branches:
      - main
    paths-ignore:
      - README.md
      - LICENSE

jobs:
  test:
    uses: ./.github/workflows/_test.yml

  build-push-image:
    uses: beeldengeluid/gha-workflows/.github/workflows/build-push-image.yml@851725b0d6bb2e3e64e48310145d65a26dccbf44 # v2024.09.02
    secrets: inherit
    needs: [test]
    permissions:
      contents: read
      packages: write
      id-token: write