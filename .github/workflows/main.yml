name: main branch - test; build & push to ghcr

on:
  push:
    branches:
      - main
    paths-ignore:
      - README.md
      - LICENSE

jobs:
  test:
    uses: ./.github/workflows/_test.yml

  build-push-image:
    uses: beeldengeluid/gha-workflows/.github/workflows/build-push-image.yml@77a90a8c2786f689be250dc0f8489bc7c9337fe2 # v2024.09.02
    secrets: inherit
    needs: [test]
    permissions:
      contents: read
      packages: write
      id-token: write